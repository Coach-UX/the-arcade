/* hockey.js  @author M.Taniguchi https://masatotaniguchi.jp/ */
var hockey=hockey||{};hockey.GiftShader={uniforms:{},vertexShader:["varying vec2	vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D	texture;","uniform vec2		uv2;","uniform float		alpha;","varying vec2		vUv;","void main() {","vec4	col = texture2D(texture, vUv + uv2);","if (col.a < 1.0) {","float	v = (1.0 - col.a) * 0.1 + 0.9411764706;","col.r = v;","col.g = v;","col.b = v;","}","gl_FragColor = col;","}"].join("\n")},hockey.ornamentTable=[[0,.2,.1,.2,.1,.1],[.1,.2,.1,.2,.1,.1],[.2,.2,.1,.2,.1,.1],[.3,.2,.1,.2,.1,.1],[.4,.2,.1,.2,.1,.1],[.5,.2,.1,.2,.1,.1],[.6,.2,.1,.2,.1,.1],[.7,.2,.1,.2,.1,.1],[.8,.2,.1,.2,.1,.1],[.9,.2,.1,.2,.1,.1],[0,.4,.1,.2,.1,.1],[.1,.4,.1,.2,.1,.1],[.2,.4,.1,.2,.1,.1],[.3,.4,.1,.2,.1,.1],[.4,.4,.1,.2,.1,.1],[.5,.4,.1,.2,.1,.1],[.6,.4,.1,.2,.1,.1],[.7,.4,.1,.2,.1,.1],[.8,.4,.1,.2,.1,.1],[.9,.4,.1,.2,.1,.1],[0,.6,.1,.2,.1,.1],[.1,.6,.1,.2,.1,.1],[.2,.6,.1,.2,.1,.1],[.3,.6,.1,.2,.1,.1],[.4,.6,.1,.2,.1,.1],[.5,.6,.1,.2,.1,.1],[.6,.6,.1,.2,.1,.1],[.7,.6,.1,.2,.1,.1]],hockey.giftTable=[0,1,3,5,6,7,8,9,11,13,14,16,17,18,19,20,21,22,23,24,25,26,27],hockey.scoreLimit=7,hockey.boardWidth=80,hockey.initializedFunction,hockey.initialized=0,hockey.initCode=0,hockey.PHASE_INIT=0,hockey.PHASE_TITLE=1,hockey.PHASE_START=2,hockey.PHASE_INGAME=3,hockey.PHASE_FINISHED=4,hockey.PHASE_GAMEOVER=5,hockey.PHASE_IDLE=6,hockey.phase=hockey.PHASE_INIT,hockey.time=0,hockey.score=[0,0],hockey.scoreDigits=2,hockey.scoreMesh,hockey.scoreWidth,hockey.puckPos=new THREE.Vector2(0,0),hockey.puckAdd=new THREE.Vector2(0,1),hockey.puckV=0,hockey.puckT=[0,0],hockey.collision=[!1,!1],hockey.enemyPos=[0,0,0],hockey.serve=.01,hockey.serveFlag=!1,hockey.goalTime=0,hockey.goalId=0,hockey.giftIndex=0,hockey.giftTableIndex=-1,hockey.getGiftTable,hockey.smokeAlpha=.45,hockey.difficulty=1,hockey.puckSpeed=[[140,7.5,333],[170,11.25,666],[200,15,3e4]],hockey.quickly=[[18,16,9,11],[27,14,21,16],[47,12,35,28]],hockey.SetPhase=function(e){if(hockey.phase!=e)switch(hockey.phase=e,hockey.time=0,hockey.phase){case hockey.PHASE_INIT:break;case hockey.PHASE_TITLE:app.debugShow&&(app.tempEle.innerHTML="hockey.title "+ ++hockey.initCode+":"+hockey.initialized),app.Fade(0,!0),app.ResetGyro(),hockey.centerLine.visible=!1,hockey.puck[0].visible=!1,hockey.puck[1].visible=!1,hockey.puck[2].visible=!1,hockey.rex.visible=!1,hockey.uni.visible=!1,hockey.wall[0].visible=!1,hockey.wall[1].visible=!1,hockey.paddle.visible=!1,hockey.enemy.visible=!1,hockey.textSwipe[0].visible=!1,hockey.textSwipe[1].visible=!1,hockey.scoreMesh[0].visible=!1,hockey.scoreMesh[1].visible=!1,hockey.goMat.uniforms.alpha.value=0,hockey.symbolMat[0].uniforms.alpha.value=.5,hockey.symbolMat[1].uniforms.alpha.value=.5,hockey.score=[0,0],hockey.puckV=0,hockey.puckT=[0,0],hockey.collision=[!1,!1],hockey.enemyPos=[0,0,0],hockey.serve=.01,hockey.goalTime=0,hockey.goalId=0,hockey.giftIndex=0,hockey.giftTableIndex=-1,hockey.goalScoreMat[0].uniforms.number.value=0,hockey.goalScoreMat[1].uniforms.number.value=0,hockey.scoreMat[0].uniforms.number.value=0,hockey.scoreMat[1].uniforms.number.value=0,app.offline?(hockey.scoreMesh[0].position.y=app.GetNumberOffset(hockey.scoreMat[0].uniforms.number.value,hockey.scoreWidth)-28,hockey.scoreMesh[1].position.y=app.GetNumberOffset(hockey.scoreMat[1].uniforms.number.value,hockey.scoreWidth)+28,hockey.goalScoreMesh[0].position.set(42,-45,0),hockey.goalScoreMesh[1].position.set(42,45,0),hockey.smokeMat.uniforms.alpha.value=hockey.smokeAlpha=.8,hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=1-hockey.smokeMat.uniforms.alpha.value,hockey.smoke.visible=!0):(hockey.scoreMesh[0].position.x=app.GetNumberOffset(hockey.scoreMat[0].uniforms.number.value,hockey.scoreWidth)-1.1*hockey.boardWidth,hockey.scoreMesh[1].position.x=app.GetNumberOffset(hockey.scoreMat[1].uniforms.number.value,hockey.scoreWidth)-1.1*hockey.boardWidth,hockey.goalScoreMesh[0].position.set(app.GetNumberOffset(hockey.goalScoreMat[0].uniforms.number.value,hockey.goalScoreWidth),-175,0),hockey.goalScoreMesh[1].position.set(app.GetNumberOffset(hockey.goalScoreMat[1].uniforms.number.value,hockey.goalScoreWidth),175,0));for(var o=0;o<hockey.getGiftTable.length;o++)hockey.getGiftTable[o]=0;app.Shuffle(hockey.giftTable),app.debugShow&&(app.tempEle.innerHTML="hockey.title "+ ++hockey.initCode+":"+hockey.initialized),board.Reset(),app.debugShow&&(app.tempEle.innerHTML="hockey.title "+ ++hockey.initCode+":"+hockey.initialized),app.Fade(1),ap.Stop(!0),app.debugShow&&(app.tempEle.innerHTML="hockey.title "+ ++hockey.initCode+":"+hockey.initialized);break;case hockey.PHASE_START:app.debugShow&&(app.tempEle.innerHTML="hockey.start "+ ++hockey.initCode+":"+hockey.initialized),app.Fade(0,!0),app.ResetGyro(),hockey.centerLine.visible=!0,hockey.puck[0].visible=!0,hockey.puck[1].visible=!0,hockey.puck[2].visible=!0,hockey.rex.visible=!0,hockey.uni.visible=!0,hockey.wall[0].visible=!0,hockey.wall[1].visible=!0,hockey.paddle.visible=!0,hockey.enemy.visible=!0,hockey.scoreMesh[0].visible=!0,hockey.scoreMesh[1].visible=!0,hockey.countdown[0].scale.set(1,1,1),hockey.countdown[1].scale.set(1,1,1),hockey.goMat.uniforms.alpha.value=0,app.TouchReset(),hockey.paddle.position.x=0,hockey.enemy.position.x=0,app.offline||(hockey.textSwipe[0].visible=!0,hockey.textSwipe[1].visible=!0),board.Reset(),app.ToggleSound(!0),app.Fade(1);break;case hockey.PHASE_INGAME:hockey.textSwipe[0].visible=!1,hockey.textSwipe[1].visible=!1,hockey.countdown[0].visible=!0,hockey.countdown[1].visible=!1,hockey.goMat.uniforms.alpha.value=hockey.goAlpha=1,hockey.puckV=hockey.puckSpeed[hockey.difficulty][0],ap.Play(!0);break;case hockey.PHASE_FINISHED:ap.Stop();break;case hockey.PHASE_GAMEOVER:app.Fade(.45),Result(!0,!1,hockey.getGiftTable),ap.Stop()}},hockey.Update=function(){var e=app.deltaTime;hockey.time+=app.deltaTime;var o=app.offline&&app.IsKeyTrigger(32);switch(hockey.phase){case hockey.PHASE_INIT:break;case hockey.PHASE_START:hockey.time>=4?hockey.SetPhase(hockey.PHASE_INGAME):hockey.time>=3?(hockey.countdownMat.uniforms.number.value=1,app.offline&&hockey.countdown[1].scale.set(2.1025,2.1025,1)):hockey.time>=2?(hockey.countdownMat.uniforms.number.value=2,app.offline&&hockey.countdown[1].scale.set(1.45,1.45,1)):hockey.time>=1&&(hockey.countdownMat.uniforms.number.value=3,hockey.countdown[1].visible=!0);break;case hockey.PHASE_INGAME:hockey.time<1?app.offline&&(hockey.smokeMat.uniforms.alpha.value=app.EaseInOut(hockey.smokeAlpha,0,hockey.time),hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=1-hockey.smokeMat.uniforms.alpha.value):hockey.countdown[0].visible&&(hockey.countdown[0].visible=!1,hockey.smokeMat.uniforms.alpha.value=0,hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=1);break;case hockey.PHASE_FINISHED:if(hockey.time>=3)return void hockey.SetPhase(hockey.PHASE_IDLE);hockey.time>=.5&&(app.Fade(.45),Result(!0,0==hockey.goalId,hockey.getGiftTable)),hockey.symbolMat[hockey.goalId].uniforms.alpha.value=Math.max(0,hockey.symbolMat[hockey.goalId].uniforms.alpha.value-.666*e),app.offline&&(hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=Math.max(0,1-.5*hockey.time));break;case hockey.PHASE_GAMEOVER:}app.offline?hockey.paddle.position.x=app.TouchX()*(hockey.boardWidth-15)*2/app.width:hockey.paddle.position.x=Math.min(hockey.boardWidth-15,Math.max(-hockey.boardWidth+15,app.TouchX()));var a=hockey.quickly[hockey.difficulty];if(hockey.phase==hockey.PHASE_INGAME&&0==hockey.serve&&hockey.goalTime<=0?hockey.puckAdd.y>0?(Math.random()<a[0]*e&&(hockey.enemyPos[2]=hockey.puck[0].position.x+Math.random()*a[1]-.5*a[1]),hockey.enemyPos[1]+=(hockey.enemyPos[2]-hockey.enemyPos[1])*(.5*a[2]+a[2]*Math.random())*e):(Math.random()<4*e&&(hockey.enemyPos[2]=hockey.puck[0].position.x*Math.random()),hockey.enemyPos[1]+=(hockey.enemyPos[2]-hockey.enemyPos[1])*(0+4*Math.random())*e):hockey.phase<=hockey.PHASE_INGAME&&(hockey.goalScoreMat[hockey.goalId].uniforms.number.value<hockey.scoreLimit?(Math.random()<3*e&&(hockey.enemyPos[2]=hockey.boardWidth*(2*Math.random()-1)),hockey.enemyPos[1]+=(hockey.enemyPos[2]-hockey.enemyPos[1])*e):hockey.enemyPos[1]-=.5*hockey.enemyPos[1]*e),hockey.enemyPos[0]+=(hockey.enemyPos[1]-hockey.enemyPos[0])*a[3]*e,hockey.enemy.position.x=Math.min(hockey.boardWidth-15,Math.max(-hockey.boardWidth+15,hockey.enemyPos[0])),hockey.phase<=hockey.PHASE_INGAME){if(0==hockey.serve)hockey.puckPos.x+=hockey.puckV*hockey.puckAdd.x*e,hockey.puckPos.y+=hockey.puckV*hockey.puckAdd.y*e,hockey.puckPos.x<=-hockey.boardWidth?(hockey.puckPos.x=-hockey.puckPos.x-2*hockey.boardWidth+.1,hockey.puckAdd.x=-hockey.puckAdd.x,hockey.puckT[1]*=.75):hockey.puckPos.x>=hockey.boardWidth&&(hockey.puckPos.x=-hockey.puckPos.x+2*hockey.boardWidth-.1,hockey.puckAdd.x=-hockey.puckAdd.x,hockey.puckT[1]*=.75),hockey.Hit(0,e)||hockey.Hit(1,e)||(hockey.Goal(0),hockey.Goal(1));else{var t=hockey.serve<0?-1:1;hockey.puckPos.x=0>t?hockey.enemy.position.x-4:hockey.paddle.position.x+4,hockey.puckPos.y=0>t?hockey.enemy.position.y-10:hockey.paddle.position.y+10,hockey.phase==hockey.PHASE_INGAME&&(hockey.serve=0>t?Math.min(0,hockey.serve+e):Math.max(0,hockey.serve-e),(0==hockey.serve||t>0&&o)&&(hockey.serve=0,hockey.puckAdd=new THREE.Vector2(t,t).normalize(),hockey.puckV=hockey.puckSpeed[hockey.difficulty][0],hockey.puckT[1]=hockey.puckAdd.x/2.2*30*-.3*t))}hockey.puckT[0]+=hockey.puckT[1]*e}if(hockey.goalTime>0){hockey.goalTime-=e;var r=4.5-hockey.goalTime;if(1>r){var c=8*Math.sin(1.5*(1-r)*Math.PI);0>c&&(c*=2),hockey.smoke.visible=!0,hockey.smokeMat.uniforms.alpha.value=app.EaseInOut(0,hockey.smokeAlpha,2*r),hockey.goal.position.z=0,hockey.goalMat.uniforms.offset.value.z=c,app.offline?(c*=.5,hockey.goalMat.uniforms.offset.value.z=c,hockey.goalMat.uniforms.alpha.value=.5,hockey.goalScoreMesh[0].position.z=0,hockey.goalScoreMesh[1].position.z=0,hockey.goalScoreMat[0].uniforms.offset.value.z=hockey.goalScoreMat[1].uniforms.offset.value.z=.75*c,hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=1-hockey.smokeMat.uniforms.alpha.value):(hockey.goalScoreMesh[0].position.y=app.EaseOut(-1500,-70,r),hockey.goalScoreMesh[1].position.y=app.EaseOut(1500,70,r),hockey.goalScoreMesh[0].position.z=app.EaseOut(-1500,0,r),hockey.goalScoreMesh[1].position.z=app.EaseOut(-1500,0,r)),hockey.serveFlag=!1}else 2>r?(hockey.goalMat.uniforms.offset.value.z=0,app.offline&&(hockey.goalScoreMat[0].uniforms.offset.value.z=hockey.goalScoreMat[1].uniforms.offset.value.z=0)):3>r?(r-=2,hockey.goal.position.z=app.EaseOut(0,-2e3,2*r),app.offline?(hockey.goalScoreMesh[0].position.z=app.EaseOut(0,-2e3,2*r),hockey.goalScoreMesh[1].position.z=app.EaseOut(0,-2e3,2*r)):(hockey.goal.visible=!1,hockey.goalScoreMesh[0].position.z=app.EaseOut(0,-2e3,2*r),hockey.goalScoreMesh[1].position.z=app.EaseOut(0,-2e3,2*r)),0==hockey.goalId?(hockey.frame.position.z=app.EaseOut(-2e3,0,2*r),hockey.halo.position.z=app.EaseOut(-2e3,-.1,2*r),hockey.ornamentMeshs[hockey.giftIndex].position.z=app.EaseOut(-2e3,0,2*r),hockey.ornamentMeshs[hockey.giftIndex].visible=!0,hockey.frame.visible=!0,hockey.halo.visible=!0):(hockey.Serve(),hockey.smokeMat.uniforms.alpha.value=app.EaseInOut(hockey.smokeAlpha,0,2*r),app.offline&&(hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=1-hockey.smokeMat.uniforms.alpha.value))):4>r?0!=hockey.goalId&&(hockey.goalTime=0):4.5>r&&(r-=4,hockey.frame.position.z=app.EaseOut(0,-2e3,2*r),hockey.halo.position.z=app.EaseOut(-.1,-2e3,2*r),hockey.ornamentMeshs[hockey.giftIndex].position.z=app.EaseOut(0,-2e3,2*r),hockey.smokeMat.uniforms.alpha.value=app.EaseInOut(hockey.smokeAlpha,0,2*r),app.offline&&(hockey.scoreMat[0].uniforms.alpha.value=hockey.scoreMat[1].uniforms.alpha.value=1-hockey.smokeMat.uniforms.alpha.value),hockey.Serve());hockey.goalTime<=0&&(hockey.goalTime=0,hockey.smoke.visible=!1,hockey.goal.visible=!1,hockey.goalScoreMesh[0].visible=!1,hockey.goalScoreMesh[1].visible=!1,hockey.ornamentMeshs[hockey.giftIndex].visible=!1,hockey.frame.visible=!1,hockey.halo.visible=!1),app.offline?hockey.ornamentMeshs[hockey.giftIndex].position.x=4*Math.sin(4.5*hockey.goalTime)+47:hockey.ornamentMeshs[hockey.giftIndex].position.y=3.5*Math.sin(4.5*hockey.goalTime)-27}app.offline&&(hockey.goMat.uniforms.alpha.value>0?(hockey.countdown[0].visible=!0,hockey.countdown[0].scale.x+=8*e,hockey.countdown[0].scale.y+=8*e,hockey.goAlpha=Math.max(0,hockey.goAlpha-e),hockey.goMat.uniforms.alpha.value=1-Math.pow(1-hockey.goAlpha,2.5)):(hockey.goMat.uniforms.alpha.value=0,hockey.goAlpha=1,hockey.countdown[0].scale.set(1,1,1))),ap.Update(app.time,e,!0)},hockey.UpdateScore=function(){return hockey.scoreMat[hockey.goalId].uniforms.number.value++,app.offline?hockey.scoreMesh[hockey.goalId].position.y=app.GetNumberOffset(hockey.scoreMat[hockey.goalId].uniforms.number.value,hockey.scoreWidth)+(0==hockey.goalId?-28:28):hockey.scoreMesh[hockey.goalId].position.x=app.GetNumberOffset(hockey.scoreMat[hockey.goalId].uniforms.number.value,hockey.scoreWidth)-1.1*hockey.boardWidth,hockey.scoreMat[hockey.goalId].uniforms.number.value>=hockey.scoreLimit?(hockey.SetPhase(hockey.PHASE_FINISHED),!0):!1},hockey.Serve=function(){!hockey.serveFlag&&0==hockey.serve&&hockey.phase<=hockey.PHASE_INGAME&&(hockey.serveFlag=!0,hockey.UpdateScore()||(hockey.puckT=[0,0],hockey.serve=0!=hockey.goalId?-1.5:1.5,app.offline&&(hockey.goMat.uniforms.alpha.value=1)))},hockey.Goal=function(e){if(hockey.goalTime<=0){var o=0!=e?1:-1;hockey.puckPos.y*o<=app.height*-.5&&(hockey.goalId=e,hockey.goalTime=4.5,hockey.goal.visible=!0,hockey.goalScoreMesh[0].visible=!0,hockey.goalScoreMesh[1].visible=!0,hockey.goalScoreMat[hockey.goalId].uniforms.number.value++,app.offline||(hockey.goalScoreMesh[hockey.goalId].position.x=app.GetNumberOffset(hockey.goalScoreMat[hockey.goalId].uniforms.number.value,hockey.goalScoreWidth)),0==e&&(hockey.giftTableIndex=(hockey.giftTableIndex+1)%hockey.giftTable.length,hockey.giftIndex=hockey.giftTable[hockey.giftTableIndex],hockey.getGiftTable[hockey.giftIndex]++,hockey.frameMat.uniforms.uv2.value=new THREE.Vector2(hockey.ornamentTable[hockey.giftIndex][0],hockey.ornamentTable[hockey.giftIndex][1])))}},hockey.Hit=function(e,o){var a,t,r=!1;0==e?(a=1,t=hockey.paddle.position):(a=-1,t=hockey.enemy.position);var c=hockey.puckPos.y*a,h=t.y*a;if(h+9>=c){if(c>=h-Math.abs(hockey.puckV*o)&&!hockey.collision[e]){var i=hockey.puckSpeed[hockey.difficulty],n=hockey.puckPos.x-t.x,p=Math.abs(n);30>p&&(hockey.collision[e]=!0,3>p&&(n=n>=0?3:-3),hockey.puckAdd.x=2.2*n/30,hockey.puckAdd.y=a,hockey.puckAdd.normalize(),hockey.puckV=Math.min(i[2],hockey.puckV+i[1]),hockey.puckT[1]=n*-.3*a,r=!0)}}else hockey.collision[e]=!1;return r},hockey.Draw=function(){for(var e=hockey.puck.length-1;e>=0;--e)hockey.puck[e].position.x=hockey.puckPos.x,hockey.puck[e].position.y=hockey.puckPos.y,hockey.puck[e].rotation.z=hockey.puckT[0];board.Draw()},hockey.Input=function(e,o){},hockey.ornamentNames=[["HEART ORNAMENT",10],["HEART ORNAMENT",10],["HEART ORNAMENT",10],["SHARKY ORNAMENT",10],["CHRISTMAS TREE",10],["CHRISTMAS TREE",10],["DOG ORNAMENT",10],["UNI ORNAMENT",10],["FROGGY ORNAMENT",10],["REXY ORNAMENT",10],["REXY ORNAMENT",10],["REXY ORNAMENT",10],["CLOVER ORNAMENT",10],["SNOWFLAKE ORNAMENT",9],["SNOWFLAKE ORNAMENT",9],["STAR ORNAMENT",10],["STAR ORNAMENT",10],["STAR ORNAMENT",10],["LIP ORNAMENT",10],["COACH ORNAMENT",10],["BOW ORNAMENT",10],["ICE CREAM ORNAMENT",10],["SNOWMAN ORNAMENT",10],["DEER ORNAMENT",10],["CROWN ORNAMENT",10],["CHERRY ORNAMENT",10],["BASEBALL BALL ORNAMENT",8],["LIGHTNING BOLT ORNAMENT",8]],hockey.Initialize=function(e){app.debugShow&&(app.tempEle.innerHTML="hockey.init "+ ++hockey.initCode+":"+hockey.initialized);var o,a,t;o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.texture},alpha:{value:1}},blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),app.offline?app.textureLoader.load("./img/HockeyBgOffline.png",function(e){e.format=THREE.RGBAFormat,e.generateMipmaps=!1,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,hockey.offlineBgTexture=e;var o=new THREE.ShaderMaterial({uniforms:{texture:{value:hockey.offlineBgTexture},alpha:{value:1}},blending:THREE.NormalBlending,transparent:!1,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),t=app.CreateMesh(1672500/1019,2500,0,o,[0,0,1,1,1,1]);t.position.set(0,0,-1e3),app.frontScene.add(t),o=new THREE.ShaderMaterial({uniforms:{texture:{value:hockey.offlineBgTexture},alpha:{value:1}},vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),a=1.83,v=.61,v2=669*v/1019*4/3,t=app.CreateMesh(300*a,398*a,0,o,[(1-1*v)/2,(1-1*v2)/2,1*v,1*v2,1,1]),t.position.set(0,0,-449),app.frontScene.add(t)}):(t=app.CreateMesh(1003500/1019,1500,0,o,app.table.HockeyBg1b),t.position.set(0,0,-1e3),app.backScene.add(t)),a=1.5125,t=app.offline?app.CreateMesh(669*a,1019*a,0,o,app.table.HockeyBg2):app.CreateMesh(669*a,1019*a,0,o,app.table.HockeyBg2),t.position.set(0,0,-995),app.backScene.add(t),app.offline?(hockey.centerLine=app.CreateMesh(350,1.9,0,o,app.table.HockeyBar),hockey.centerLine.position.set(0,0,-110),app.backScene.add(hockey.centerLine)):(hockey.centerLine=app.CreateMesh(350,1.9,0,o,app.table.HockeyBar),hockey.centerLine.position.set(0,0,-100),app.frontScene.add(hockey.centerLine)),hockey.centerLine.visible=!1,hockey.puck=new Array,app.offline?(hockey.puck[0]=app.CreateMesh(17,17,0,o,app.table.Pack),hockey.puck[0].position.set(0,90,-7),app.backScene.add(hockey.puck[0])):(hockey.puck[0]=app.CreateMesh(17,17,0,o,app.table.Pack),hockey.puck[0].position.set(0,90,3),app.frontScene.add(hockey.puck[0])),hockey.puck[0].visible=!1,app.offline?(hockey.puck[1]=app.CreateMesh(17,17,0,o,app.table.PackShadow),hockey.puck[1].position.set(0,90,-13),app.backScene.add(hockey.puck[1])):(hockey.puck[1]=app.CreateMesh(17,17,0,o,app.table.PackShadow),hockey.puck[1].position.set(0,90,-3),app.frontScene.add(hockey.puck[1])),hockey.puck[1].visible=!1,o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.texture},alpha:{value:.5}},blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),app.offline?(o.uniforms.alpha.value=1,a=.93,t=app.CreateMesh(600*a,800*a,0,o,app.table.HockeyBg3),t.position.set(0,0,-451),app.backScene.add(t)):(a=1.5125,t=app.CreateMesh(1019*a,669*a,0,o,app.table.HockeyBg2),t.position.set(0,0,-990),t.rotation.set(0,0,Math.PI*-.5),app.backScene.add(t)),app.offline&&(o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.offRenderTarget},alpha:{value:.5}},blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),a=.85,t=app.CreateMesh(1600*a,900*a,0,o,[0,0,1,1,1,1]),t.position.set(0,0,-450),t.rotation.set(0,0,Math.PI*-.5),app.frontScene.add(t),o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.offRenderTarget},alpha:{value:1}},blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),t=app.CreateMesh(1600*a,900*a,0,o,[0,0,1,1,1,1]),t.position.set(0,0,-450),t.rotation.set(0,0,Math.PI*-.5),app.backScene.add(t)),hockey.symbolMat=new Array,hockey.symbolMat[0]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.symbolTexture},alpha:{value:.5}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),app.offline?hockey.rex=app.CreateMesh(330,330,0,hockey.symbolMat[0],app.symbolTable.HockeySymbolRex):hockey.rex=app.CreateMesh(330,330,0,hockey.symbolMat[0],app.symbolTable.HockeySymbolRex),hockey.rex.position.set(0,-190,-500),hockey.rex.visible=!1,app.backScene.add(hockey.rex),hockey.symbolMat[1]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.symbolTexture},alpha:{value:.5}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),app.offline?hockey.uni=app.CreateMesh(330,330,0,hockey.symbolMat[1],app.symbolTable.HockeySymbolUni):hockey.uni=app.CreateMesh(330,330,0,hockey.symbolMat[1],app.symbolTable.HockeySymbolUni),hockey.uni.rotation.set(0,0,Math.PI),hockey.uni.position.set(0,190,-500),hockey.uni.visible=!1,app.backScene.add(hockey.uni),o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.texture},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),hockey.wall=new Array,app.offline?(a=.26666,hockey.wall[0]=app.CreateMesh(128*a,970*a,0,o,app.table.HockeyWall),hockey.wall[1]=hockey.wall[0].clone(),hockey.wall[0].position.set(-(hockey.boardWidth+7),0,-10),hockey.wall[1].position.set(hockey.boardWidth+7,0,-10),app.backScene.add(hockey.wall[0]),app.backScene.add(hockey.wall[1])):(a=.275,hockey.wall[0]=app.CreateMesh(128*a,1088*a,0,o,app.table.HockeyWall),hockey.wall[1]=hockey.wall[0].clone(),hockey.wall[0].position.set(-(hockey.boardWidth+7),0,0),hockey.wall[1].position.set(hockey.boardWidth+7,0,0),app.frontScene.add(hockey.wall[0]),app.frontScene.add(hockey.wall[1])),hockey.wall[0].visible=!1,hockey.wall[1].visible=!1,a=.15,app.offline?(hockey.paddle=app.CreateMesh(448*a,224*a,0,o,app.table.Paddle1),hockey.paddle.position.set(0,-107,-10),app.backScene.add(hockey.paddle)):(hockey.paddle=app.CreateMesh(448*a,224*a,0,o,app.table.Paddle1),hockey.paddle.position.set(0,-110,0),app.frontScene.add(hockey.paddle)),hockey.paddle.visible=!1,app.offline?(hockey.enemy=app.CreateMesh(448*a,224*a,0,o,app.table.Paddle2),hockey.enemy.position.set(0,107,-10),app.backScene.add(hockey.enemy)):(hockey.enemy=app.CreateMesh(448*a,224*a,0,o,app.table.Paddle2),hockey.enemy.position.set(0,110,0),app.frontScene.add(hockey.enemy)),hockey.enemy.visible=!1,o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.texture},alpha:{value:.525}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),app.offline?(hockey.puck[2]=app.CreateMesh(72,72,0,o,app.table.SunHalo),hockey.puck[2].position.set(0,90,-13.1),app.backScene.add(hockey.puck[2])):(hockey.puck[2]=app.CreateMesh(72,72,0,o,app.table.SunHalo),hockey.puck[2].position.set(0,90,-3.1),app.frontScene.add(hockey.puck[2])),hockey.puck[2].visible=!1,o=new THREE.ShaderMaterial({uniforms:{texture:{value:app.fontTexture},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),hockey.textSwipe=new Array,hockey.textSwipe[0]=app.CreateFontMesh("<             >",18,o),hockey.textSwipe[0].scale.set(1,1,1),hockey.textSwipe[0].position.set(0,-122,0),hockey.textSwipe[0].visible=!1,app.uiScene.add(hockey.textSwipe[0]),hockey.textSwipe[1]=app.CreateFontMesh("SWIPE TO MOVE",8.5,o),hockey.textSwipe[1].scale.set(1,1,1),hockey.textSwipe[1].position.set(0,-122,0),hockey.textSwipe[1].visible=!1,app.uiScene.add(hockey.textSwipe[1]),hockey.ornamentMeshs=new Array;for(var r=0;r<hockey.ornamentNames.length;r++)hockey.ornamentMeshs[r]=app.CreateFontMesh(hockey.ornamentNames[r][0],hockey.ornamentNames[r][1],o,!1,!0),hockey.ornamentMeshs[r].position.set(0,-27,0),hockey.ornamentMeshs[r].visible=!1,app.uiScene.add(hockey.ornamentMeshs[r]),app.offline&&(hockey.ornamentMeshs[r].position.set(0,0,0),hockey.ornamentMeshs[r].scale.set(1.25,1.25,1),hockey.ornamentMeshs[r].rotation.set(0,0,.5*Math.PI));hockey.goMat=new THREE.ShaderMaterial({uniforms:{texture:{value:app.fontTexture},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),hockey.countdown=new Array,hockey.countdown[0]=app.CreateFontMesh("GO",60,hockey.goMat),hockey.countdown[0].scale.set(1,1,1),hockey.countdown[0].position.set(0,0,0),hockey.countdown[0].visible=!1,app.uiScene.add(hockey.countdown[0]),hockey.countdownMat=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:3},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberShader.vertexShader,fragmentShader:app.NumberShader.fragmentShader}),hockey.countdown[1]=app.CreateNumberMesh(1,60,hockey.countdownMat)[0],hockey.countdown[1].position.set(0,0,0),hockey.countdown[1].visible=!1,app.offline?(hockey.countdown[0].rotation.set(0,0,.5*Math.PI),hockey.countdown[1].rotation.set(0,0,.5*Math.PI),app.uiBackScene.add(hockey.countdown[1])):app.uiScene.add(hockey.countdown[1]),hockey.scoreMat=new Array,hockey.scoreMat[0]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:0},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberShader.vertexShader,fragmentShader:app.NumberShader.fragmentShader}),app.offline?temp=app.CreateNumberMesh(hockey.scoreDigits,29.333,hockey.scoreMat[0]):temp=app.CreateNumberMesh(hockey.scoreDigits,29,hockey.scoreMat[0]),hockey.scoreMesh=new Array,hockey.scoreMesh[0]=temp[0],hockey.scoreWidth=temp[1],hockey.scoreMesh[0].position.set(app.GetNumberOffset(hockey.scoreMat[0].uniforms.number.value,hockey.scoreWidth)-1.1*hockey.boardWidth,-26,-100),hockey.scoreMesh[0].visible=!1,app.frontScene.add(hockey.scoreMesh[0]),hockey.scoreMat[1]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:0},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberShader.vertexShader,fragmentShader:app.NumberShader.fragmentShader}),app.offline?hockey.scoreMesh[1]=app.CreateNumberMesh(hockey.scoreDigits,29.333,hockey.scoreMat[1])[0]:hockey.scoreMesh[1]=app.CreateNumberMesh(hockey.scoreDigits,29,hockey.scoreMat[1])[0],hockey.scoreMesh[1].position.set(app.GetNumberOffset(hockey.scoreMat[1].uniforms.number.value,hockey.scoreWidth)-1.1*hockey.boardWidth,26,-100),hockey.scoreMesh[1].visible=!1,app.frontScene.add(hockey.scoreMesh[1]),app.offline&&(hockey.scoreMesh[0].position.set(1.0666*hockey.boardWidth,-35.3+app.GetNumberOffset(hockey.scoreMat[0].uniforms.number.value,hockey.scoreWidth),-70),hockey.scoreMesh[1].position.set(1.0666*hockey.boardWidth,35.3+app.GetNumberOffset(hockey.scoreMat[1].uniforms.number.value,hockey.scoreWidth),-70),hockey.scoreMesh[0].rotation.set(0,0,.5*Math.PI),hockey.scoreMesh[1].rotation.set(0,0,.5*Math.PI)),hockey.goalScoreMesh=new Array,hockey.goalScoreMat=new Array,app.offline?(hockey.goalScoreMat[0]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:0},offset:{value:new THREE.Vector3(0,0,0)},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberBlurShader.vertexShader,fragmentShader:app.NumberBlurShader.fragmentShader}),hockey.goalScoreMesh[0]=app.CreateBlurFontMesh("0",30,hockey.goalScoreMat[0],64,!0),hockey.goalScoreMesh[0].visible=!1,app.uiScene.add(hockey.goalScoreMesh[0]),hockey.goalScoreMat[1]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:0},offset:{value:new THREE.Vector3(0,0,0)},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberBlurShader.vertexShader,fragmentShader:app.NumberBlurShader.fragmentShader}),hockey.goalScoreMesh[1]=app.CreateBlurFontMesh("0",30,hockey.goalScoreMat[1],64,!0),hockey.goalScoreMesh[1].visible=!1,app.uiScene.add(hockey.goalScoreMesh[1]),hockey.goalScoreMesh[0].rotation.set(0,0,.5*Math.PI),hockey.goalScoreMesh[1].rotation.set(0,0,.5*Math.PI),hockey.goalScoreMesh[0].scale.set(.9,1.2,1),hockey.goalScoreMesh[1].scale.set(.9,1.2,1)):(hockey.goalScoreMat[0]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:0},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberShader.vertexShader,fragmentShader:app.NumberShader.fragmentShader}),temp=app.CreateNumberMesh(hockey.scoreDigits,30,hockey.goalScoreMat[0]),hockey.goalScoreMesh[0]=temp[0],hockey.goalScoreWidth=temp[1],hockey.goalScoreMesh[0].position.set(app.GetNumberOffset(hockey.goalScoreMat[0].uniforms.number.value,hockey.goalScoreWidth),-175,0),hockey.goalScoreMesh[0].visible=!1,app.uiScene.add(hockey.goalScoreMesh[0]),hockey.goalScoreMat[1]=new THREE.ShaderMaterial({uniforms:{texture:{value:app.numberTexture},number:{value:0},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.NumberShader.vertexShader,fragmentShader:app.NumberShader.fragmentShader}),hockey.goalScoreMesh[1]=app.CreateNumberMesh(hockey.scoreDigits,30,hockey.goalScoreMat[1])[0],hockey.goalScoreMesh[1].position.set(app.GetNumberOffset(hockey.goalScoreMat[1].uniforms.number.value,hockey.goalScoreWidth),175,0),hockey.goalScoreMesh[1].visible=!1,app.uiScene.add(hockey.goalScoreMesh[1])),hockey.goalMat=new THREE.ShaderMaterial({uniforms:{texture:{value:app.fontTexture},offset:{value:new THREE.Vector3(0,0,0)},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.BlurShader.vertexShader,fragmentShader:app.BlurShader.fragmentShader}),app.offline?(hockey.goal=app.CreateBlurFontMesh("GOAL",35,hockey.goalMat,64),hockey.goal.position.set(-21,0,0),hockey.goal.scale.set(1.4,2,1),hockey.goal.rotation.set(0,0,.5*Math.PI)):hockey.goal=app.CreateBlurFontMesh("GOAL",35,hockey.goalMat,32),hockey.goal.visible=!1,app.uiScene.add(hockey.goal),hockey.smokeMat=new THREE.ShaderMaterial({uniforms:{texture:{value:app.texture},alpha:{value:0}},blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),hockey.smoke=app.CreateMesh(4*app.width,4*app.height,0,hockey.smokeMat,app.table.Black),app.offline?(hockey.smoke.position.set(0,0,-500),hockey.smoke.rotation.set(0,0,.5*Math.PI),app.uiBackScene.add(hockey.smoke),hockey.smokeMat.uniforms.alpha.value=hockey.smokeAlpha=.8):(hockey.smoke.position.set(0,0,-500),app.uiScene.add(hockey.smoke)),hockey.haloMat=new THREE.ShaderMaterial({uniforms:{texture:{value:app.texture},alpha:{value:1}},blending:THREE.AdditiveBlending,transparent:!0,depthWrite:!1,vertexShader:app.PlaneShader.vertexShader,fragmentShader:app.PlaneShader.fragmentShader}),hockey.halo=app.CreateMesh(3e3*app.table.SunHalo[4],3e3*app.table.SunHalo[5],0,hockey.haloMat,app.table.SunHalo),hockey.halo.position.set(0,20,-2e3),hockey.halo.rotation.set(0,0,.25*Math.PI),hockey.halo.visible=!1,app.uiScene.add(hockey.halo),app.offline&&(hockey.halo.position.set(-15,0,-2e3),hockey.halo.scale.set(1.4,1.4,1),hockey.halo.rotation.set(0,0,.5*Math.PI)),app.textureLoader.load("./img/ornament.png",function(e){e.format=THREE.RGBAFormat,e.generateMipmaps=!0,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,hockey.frameMat=new THREE.ShaderMaterial({uniforms:{texture:{value:e},uv2:{value:new THREE.Vector2(0,0)},alpha:{value:1}},blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:hockey.GiftShader.vertexShader,fragmentShader:hockey.GiftShader.fragmentShader}),hockey.frame=app.CreateMesh(600*hockey.ornamentTable[0][4],600*hockey.ornamentTable[0][5],0,hockey.frameMat,[0,0,.1,.2,.1,.1]),hockey.frame.position.set(0,20,-2e3),hockey.frame.visible=!1,app.uiScene.add(hockey.frame),app.offline&&(hockey.frame.position.set(-15,0,-2e3),hockey.frame.scale.set(1.4,1.4,1),hockey.frame.rotation.set(0,0,.5*Math.PI)),hockey.initialized++,app.debugShow&&(app.tempEle.innerHTML="hockey.init "+ ++hockey.initCode+":"+hockey.initialized)}),hockey.getGiftTable=new Array(hockey.ornamentTable.length),app.debugShow&&(app.tempEle.innerHTML="hockey.init "+ ++hockey.initCode+":"+hockey.initialized),
board.Initialize(),app.offline&&(app.frontCamera.rotation.z=.5*Math.PI,app.mask[0].rotation.z=app.mask[1].rotation.z=Math.PI*-.5),app.uiFix=!0,app.gameUpdateFunction=hockey.Update,app.gameDrawFunction=hockey.Draw,void 0!=e&&(hockey.initializedFunction=e,setTimeout(function(){hockey.WaitInitialized()},50)),app.debugShow&&(app.tempEle.innerHTML="hockey.init "+ ++hockey.initCode+":"+hockey.initialized)},hockey.IsInitialized=function(){return hockey.initialized>=1},hockey.WaitInitialized=function(){hockey.IsInitialized()?(hockey.Reset(),void 0!=hockey.initializedFunction&&hockey.initializedFunction()):(app.debugShow&&(app.tempEle.innerHTML="hockey.initWait "+hockey.initCode+":"+hockey.initialized),setTimeout(function(){hockey.WaitInitialized()},100))},hockey.Start=function(e){hockey.difficulty=void 0!=e?e:1,hockey.SetPhase(hockey.PHASE_START),app.debugShow&&(app.tempEle.innerHTML="hockey.start")},hockey.Reset=function(){hockey.SetPhase(hockey.PHASE_TITLE,!0)},hockey.Name=function(){return"hockey"};var board=board||{};board.Shader={uniforms:{},positionShader:["uniform float	delta;","#define tpi (6.283185307 / 4.0)","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec4 pos = texture2D(texturePosition, uv);","vec2 vel = texture2D(textureVelocity, uv).xy;","pos.xy += vec2(cos(vel.x * 0.03125), sin(vel.x * 0.03125)) * 40.0 * delta;","pos.xy = mod(pos.xy + 1024.0 + 2048.0, 2048.0) - 1024.0;","pos.w = tpi * mod(gl_FragCoord.x, 4.0) + vel.y * 0.00390625;","gl_FragColor = pos;","}"].join("\n"),offlinePositionShader:["uniform float	delta;","#define tpi (6.283185307 / 4.0)","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec4 pos = texture2D(texturePosition, uv);","vec2 vel = texture2D(textureVelocity, uv).xy;","pos.xy += vec2(cos(vel.x * 0.03125), sin(vel.x * 0.03125)) * 40.0 * delta;","pos.xy = mod(pos.xy + 1280.0 + 2560.0, 2560.0) - 1280.0;","pos.w = tpi * mod(gl_FragCoord.x, 4.0) + vel.y * 0.00390625;","gl_FragColor = pos;","}"].join("\n"),velocityShader:["#include <common>","uniform float	delta;","#define tpi (6.283185307 * 256.0)","void main() {","vec2 uv = gl_FragCoord.xy / resolution.xy;","vec4 vel = texture2D(textureVelocity, uv);","vel.y = mod(vel.y + vel.x * 0.125 * delta, tpi);","gl_FragColor = vel;","}"].join("\n"),vertexShader:["#include <common>","uniform sampler2D texturePosition;","uniform sampler2D textureVelocity;","varying vec2 vUv;","void main() {","vec4 pos = texture2D(texturePosition, uv);","vec4 vel = texture2D(textureVelocity, uv);","float	s = mod(pos.z, 64.0) * 2.0;","pos = vec4(pos.x * 0.6 + s * cos(pos.w), pos.y * 0.6 + s * sin(pos.w), pos.z / -64.0, 1.0);","vUv = vel.zw;","gl_Position = projectionMatrix * modelViewMatrix * pos;","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform float alpha;","varying vec2 vUv;","void main() {","vec4 color = texture2D(texture, vUv);","color.a *= alpha;","gl_FragColor = color;","}"].join("\n")},board.gpuCompute,board.positionVariable,board.velocityVariable,board.particleUniforms,board.particles=576,board.particlesWidth=Math.ceil(Math.sqrt(board.particles)),board.table={HockeyFloat01:[0,.5,.28125,.1875,.28125,.1875],HockeyFloat02:[.78125,0,.21875,.21875,.21875,.21875],HockeyFloat03:[.28125,.5,.125,.3125,.125,.3125],HockeyFloat04:[.59375,.53125,.1875,.140625,.1875,.140625],HockeyFloat05:[.53125,.28125,.25,.25,.25,.25],HockeyFloat06:[.6875,.671875,.0625,.0625,.0625,.0625],HockeyFloat07:[.53125,0,.25,.28125,.25,.28125],HockeyFloat08:[.78125,.21875,.21875,.21875,.21875,.21875],HockeyFloat09:[0,.6875,.0625,.0625,.0625,.0625],HockeyFloat10:[.78125,.4375,.21875,.21875,.21875,.21875],HockeyFloat11:[.90625,.65625,.09375,.09375,.09375,.09375],HockeyFloat12:[.78125,.65625,.125,.1875,.125,.1875],HockeyFloat13:[.40625,.53125,.1875,.1875,.1875,.1875],HockeyFloat14:[0,0,.53125,.5,.53125,.5],HockeyFloat15:[.59375,.671875,.09375,.09375,.09375,.09375],Transparent:[.40625,.5,.03125,.03125,.03125,.03125]},board.Reset=function(){board.RestartSimulation(),board.Draw(!0)},board.Draw=function(){board.positionUniforms.delta.value=app.deltaTime,board.velocityUniforms.delta.value=app.deltaTime,board.gpuCompute.compute(),board.particleUniforms&&(board.particleUniforms.texturePosition.value=board.gpuCompute.getCurrentRenderTarget(board.positionVariable).texture,board.particleUniforms.textureVelocity.value=board.gpuCompute.getCurrentRenderTarget(board.velocityVariable).texture)},board.InitComputeRenderer=function(){board.gpuCompute=new GPUComputationRenderer(board.particlesWidth,board.particlesWidth,app.renderer);var e=board.gpuCompute.createTexture(),o=board.gpuCompute.createTexture();board.InitTextures(e,o),board.velocityVariable=board.gpuCompute.addVariable("textureVelocity",board.Shader.velocityShader,o),app.offline?board.positionVariable=board.gpuCompute.addVariable("texturePosition",board.Shader.offlinePositionShader,e):board.positionVariable=board.gpuCompute.addVariable("texturePosition",board.Shader.positionShader,e),board.gpuCompute.setVariableDependencies(board.velocityVariable,[board.positionVariable,board.velocityVariable]),board.gpuCompute.setVariableDependencies(board.positionVariable,[board.positionVariable,board.velocityVariable]),board.positionUniforms=board.positionVariable.material.uniforms,board.velocityUniforms=board.velocityVariable.material.uniforms,board.velocityUniforms.delta={value:1/60},board.positionUniforms.delta={Value:1/60};var a=board.gpuCompute.init();null!==a&&(console.error(a),app.Unsupported())},board.RestartSimulation=function(){var e=board.gpuCompute.createTexture(),o=board.gpuCompute.createTexture();board.InitTextures(e,o),board.gpuCompute.renderTexture(e,board.positionVariable.renderTargets[0]),board.gpuCompute.renderTexture(e,board.positionVariable.renderTargets[1]),board.gpuCompute.renderTexture(o,board.velocityVariable.renderTargets[0]),board.gpuCompute.renderTexture(o,board.velocityVariable.renderTargets[1])},board.InitPosition=function(){for(var e=new THREE.BufferGeometry,o=new Float32Array(3*board.particles),a=0,t=0;t<board.particles;t++)o[a++]=0,o[a++]=0,o[a++]=0;for(var r=new Float32Array(2*board.particles),c=0,t=0;c<board.particlesWidth;c++)for(var h=0;h<board.particlesWidth;h++)r[t++]=h/(board.particlesWidth-1),r[t++]=c/(board.particlesWidth-1);e.addAttribute("position",new THREE.BufferAttribute(o,3)),e.addAttribute("uv",new THREE.BufferAttribute(r,2));for(var i=new Uint16Array(6*board.particles/4),t=0,n=0;t<board.particles;t+=4)i[n++]=t+0,i[n++]=t+1,i[n++]=t+2,i[n++]=t+0,i[n++]=t+2,i[n++]=t+3;e.setIndex(new THREE.BufferAttribute(i,1)),e.addGroup({start:0,count:i.length}),app.textureLoader.load("./img/icons.png",function(o){o.format=THREE.RGBAFormat,o.generateMipmaps=!0,o.minFilter=THREE.LinearFilter,o.magFilter=THREE.LinearFilter,board.particleUniforms={texture:{value:o},texturePosition:{value:null},textureVelocity:{value:null},alpha:{value:1},delta:{value:0}};var a=new THREE.ShaderMaterial({uniforms:board.particleUniforms,blending:THREE.NormalBlending,transparent:!0,depthWrite:!1,vertexShader:board.Shader.vertexShader,fragmentShader:board.Shader.fragmentShader});a.extensions.drawBuffers=!0;var t=new THREE.Mesh(e,a);t.matrixAutoUpdate=!1,t.updateMatrix(),app.offline?app.offScene.add(t):app.backScene.add(t)})},board.InitTextures=function(e,o){for(var a,t,r,c,h,i,n,p,l=e.image.data,k=o.image.data,s=new Float32Array([0,0,1,0,1,1,0,1]),y=["HockeyFloat01","HockeyFloat02","HockeyFloat03","Transparent","HockeyFloat04","HockeyFloat05","HockeyFloat06","Transparent","HockeyFloat07","HockeyFloat08","HockeyFloat09","Transparent","HockeyFloat10","HockeyFloat11","HockeyFloat12","Transparent","HockeyFloat13","HockeyFloat14","HockeyFloat15","Transparent","HockeyFloat09","HockeyFloat15","HockeyFloat09","HockeyFloat15"],d=0,u=0,m=l.length/16;m>u;u++){t=(2*Math.random()-1)*Math.PI,r=5e4*(Math.random()-0),c=5e4*(Math.random()-0),h=(.5*Math.random()-.25)*Math.PI,i=y[u%y.length],a=board.table[i],p="HockeyFloat05"!=i&&"HockeyFloat14"!=i?Math.random():.2*Math.random(),n=-350*p-77.5,n=64*Math.floor(-n)+Math.floor(64*Math.sqrt(Math.pow(a[4],2)+Math.pow(a[5],2))*(1+p));for(var f=0;4>f;f++)l[d]=r,l[d+1]=c,l[d+2]=n,l[d+3]=Math.PI*f*.5,k[d]=256*t,k[d+1]=h,k[d+2]=a[0]+a[2]*s[2*f],k[d+3]=a[1]+a[3]*s[2*f+1],d+=4}},board.Initialize=function(){board.InitComputeRenderer(),board.InitPosition()};